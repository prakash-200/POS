<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POS</title>
    <link rel="stylesheet" href="css/billing.css" />
    <!-- Bootstrap CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <header class="header"></header>
    <main>
      <div class="left-section vh-100">
        <div class="bill h-50" id="billContent">
          <div class="left-start-section">
            <div class="total-price fw-bold">
              <div class="grp mx-2">Change: <span id="balance">0.00</span></div>
            </div>
            <div class="d-flex justify-content-between mx-3 fw-medium">
              <label>Amount</label>
              <p id="amount">$0.00</p>
            </div>
            <div class="d-flex justify-content-between mx-3 fw-medium">
              <label>GST Amount</label>
              <p id="gstAmount">$0.00</p>
            </div>
            <hr class="" style="margin-top: -10px" />
            <div
              class="d-flex justify-content-between text-danger fs-5 fw-bold m-3"
              style="position: relative; top: -10px"
            >
              Payable: <span id="payableAmount" class="fw-medium">$0.00</span>
            </div>
            <hr style="margin-top: -10px" />
          </div>
          <div class="left-center-section w-100" style="margin-top: -10px">
            <div class="d-flex justify-content-between text-primary fw-bold">
              <span style="margin-left: -5px; padding-bottom: 5px"
                >Tender:</span
              >
              <span id="tender" class="" style="padding-right: 40px"
                >$0.00</span
              >
            </div>
            <div class="d-flex justify-content-between text-primary fw-bold">
              <span style="margin-left: -5px">Change:</span>
              <span id="change" class="" style="padding-right: 40px"
                >$0.00</span
              >
            </div>
          </div>
        </div>
        <div class="left-end-section h-50">
          <div class="left-end-top">
            <form action="" method="POST">
              <div>
                Item Name <br />
                <select class="form-select" id="itemName">
                  <option selected disabled>Select an Item</option>
                </select>
              </div>
              <div>
                Quantity <br />
                <input type="number" name="quantity" id="quantity" required />
              </div>
              <div>
                <br />
                <button name="add" id="addItem">Add</button>
              </div>
            </form>
          </div>
          <br />
          <div class="left-end-bottom">
            <div class="left-end-bottom-start">
              <div>
                <button name="lang">Language</button>
                <div>
                  <center>Table No</center>
                  <input type="number" name="table-no" id="table-no" />
                </div>
                <div>
                  <center>No of Cover</center>
                  <input type="number" name="cover-nos" id="cover-nos" />
                </div>
              </div>
            </div>
            <div class="left-end-bottom-center">
              <div class="number-grid">
                <button name="cal" class="numberButton" data-value="7">
                  7
                </button>
                <button name="cal" class="numberButton" data-value="8">
                  8
                </button>
                <button name="cal" class="numberButton" data-value="9">
                  9
                </button>
                <button name="cal" class="numberButton" data-value="4">
                  4
                </button>
                <button name="cal" class="numberButton" data-value="5">
                  5
                </button>
                <button name="cal" class="numberButton" data-value="6">
                  6
                </button>
                <button name="cal" class="numberButton" data-value="1">
                  1
                </button>
                <button name="cal" class="numberButton" data-value="2">
                  2
                </button>
                <button name="cal" class="numberButton" data-value="3">
                  3
                </button>
                <button name="cal" class="numberButton" data-value="0">
                  0
                </button>
                <button name="cal">.</button>
                <button name="cal">-</button>
              </div>
            </div>
            <div class="left-end-bottom-end">
              <div>
                <button name="ac" id="removeButton" style="padding-right: 50px">
                  AC
                </button>
              </div>
              <div>
                <button
                  name="clear"
                  id="clearButton"
                  style="padding-right: 50px"
                >
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="right-section">
        <div class="right-top-section h-75" style="padding-bottom: 100px">
          <div class="sidebar">
            <div class="sidebar-nav">
              <div class="scroll-container">
                <button class="scroll-up w-100 d-flex">
                  <i
                    class="fas fa-chevron-up"
                    style="color: #000000; padding-left: 40px"
                  ></i>
                </button>
                <div class="scrollable-categories"></div>
                <button class="scroll-down w-100 d-flex">
                  <i
                    class="fas fa-chevron-down"
                    style="color: #000000; padding-left: 40px"
                  ></i>
                </button>
              </div>
            </div>
          </div>
          <div class="inventory" style="background-color: aliceblue">
            <!-- Images loaded based on inventory items -->
          </div>
        </div>
        <div class="right-bottom-section h-50" style="margin-top: -80px">
          <div class="box1">
            <button class="box1-btn1" id="newBillButton">New Bill</button>
            <button class="box1-btn2">Price Amendment</button>
          </div>
          <div class="box2">
            <button class="box2-btn1" id="numberButton" data-value="2">
              $2
            </button>
          </div>
          <div class="box3">
            <button class="box3-btn1" id="numberButton" data-value="10">
              $10
            </button>
          </div>
          <div class="box4">
            <button class="box4-btn1">Open Cash Box</button>
            <button class="box4-btn2">Terminate Transaction</button>
          </div>
          <div class="box5">
            <button class="box5-btn1">Goods Return</button>
            <button class="box5-btn2" id="saveButton">Print</button>
          </div>
          <div class="box6">
            <button class="box6-btn1">Cancel Item</button>
          </div>
          <div class="box7">
            <button class="box7-btn1">Add Item</button>
          </div>
          <div class="box8">
            <button class="box8-btn1" id="billButton">
              <i class="fa-solid fa-play" style="color: #000000"
                ><span
                  class="text-light mx-1"
                  style="
                    font-family: 'Trebuchet MS', 'Lucida Sans Unicode',
                      'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
                  "
                  >Bill</span
                ></i
              >
            </button>
          </div>
          <div class="box9">
            <button class="box9-btn1" id="five" data-value="5">$5</button>
          </div>
          <div class="box10">
            <button class="box10-btn1" id="fifty" data-value="50">$50</button>
          </div>
          <div class="box11">
            <button class="box11-btn1">Gift Voucher</button>
          </div>
          <div class="box12">
            <button class="box12-btn1">Reserved Transaction</button>
            <button class="box12-btn2">Restore</button>
          </div>
          <div class="box13">
            <button class="box13-btn1">Delete All Transaction</button>
          </div>
          <div class="box14">
            <button class="box14-btn1">
              <a href="index.html" class="text-light text-decoration-none"
                >Main Menu</a
              >
            </button>
          </div>
        </div>
      </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

    <script>
      // Function to display inventory items from local storage
      function displayInventoryItems() {
        const inventoryDiv = $(".inventory");
        inventoryDiv.empty();

        // Get inventory data from local storage
        const inventoryItems =
          JSON.parse(localStorage.getItem("inventory")) || [];

        // Loop through each item in the inventory and create an image element
        inventoryItems.forEach((item) => {
          const itemButton = $(`
            <button>
                <img src="${item.image}" alt="${item.name}" />
            </button>
        `);
          inventoryDiv.append(itemButton);
        });
      }

      // Call the function to display items on page load
      $(document).ready(function () {
        displayInventoryItems();
      });

      const inventory =
        JSON.parse(localStorage.getItem("inventory")) || sampleInventory;
      let totalCost = 0;

      function populateItemDropdown() {
        const itemSelect = $("#itemName");
        inventory.forEach((item) => {
          itemSelect.append(
            `<option value="${item.name.toLowerCase()}">${
              item.name
            } - $${parseFloat(item.price).toFixed(2)}</option>`
          );
        });
      }

      // Display Images under inventory
      function displayInventoryItems() {
        const inventoryDiv = $(".inventory");
        const snackNames = [];

        inventory.forEach((item) => {
          if (item.category === "Drinks") {
            // Load images dynamically based on inventory
            inventoryDiv.append(
              `<button class="image" style="height: 100px; width: 200px;" data-name="${item.name.toLowerCase()}" data-price="${
                item.price
              }"><img src="${item.image}" alt="${
                item.name
              }" class="items" /></button>`
            );
          } else if (item.category === "Snacks") {
            snackNames.push(item.name); // Add snack names to the array
          }
        });

        // Display snack names in the scrollable area
        const snackContainer = $(".scrollable-categories");
        snackNames.forEach((name) => {
          snackContainer.append(
            `<div class="category-item bg-primary" data-value="${name}">${name}</div>`
          );
        });
      }

      // Load items into the dropdown and inventory on page load
      $(document).ready(function () {
        populateItemDropdown();
      });

      $(document).ready(function () {
        const scrollAmount = 30;

        // Scroll up functionality
        $(".scroll-up").on("click", function () {
          $(".scrollable-categories").animate(
            {
              scrollTop: "-=" + scrollAmount,
            },
            200
          ); // Adjust scroll speed if needed
        });

        // Scroll down functionality
        $(".scroll-down").on("click", function () {
          $(".scrollable-categories").animate(
            {
              scrollTop: "+=" + scrollAmount,
            },
            200
          ); // Adjust scroll speed if needed
        });
      });

      // Smooth scroll for the mouse wheel
      $(".scrollable-categories").on("wheel", function (e) {
        e.preventDefault();
        const delta = e.originalEvent.deltaY;

        $(this).animate(
          {
            scrollTop: $(this).scrollTop() + delta,
          },
          200
        );
      });

      // For display amount from local storage
      let payableAmount = 0;
      let gstAmount = 0;
      let totalAmount = 0;
      $(document).ready(function () {
        totalAmount = parseFloat(localStorage.getItem("totalAmount"));

        // Calculate GST (7%)
        gstAmount = totalAmount * 0.07;

        // Calculate payable amount (total + GST)
        payableAmount = totalAmount + gstAmount;

        // Update the amounts on the page
        $("#amount").text(`$${totalAmount.toFixed(2)}`);
        $("#gstAmount").text(`$${gstAmount.toFixed(2)}`);
        $("#payableAmount").text(`$${payableAmount.toFixed(2)}`);
      });

      // Function to update tender amount and balance
      let tenderAmount = 0;
      function updateTender(value) {
        tenderAmount += value;

        // Display the updated tender amount
        $("#tender").text(`$${tenderAmount.toFixed(2)}`);

        // Calculate and display the change
        const change = tenderAmount - payableAmount;
        $("#change").text(`$${change.toFixed(2)}`);

        // Update the balance amount
        $("#balance").text(`$${change.toFixed(2)}`);
      }

      // Event listeners for the tender buttons
      $("#five").on("click", function () {
        updateTender(5);
      });

      $("#fifty").on("click", function () {
        updateTender(50);
      });

      $("#numberButton[data-value='2']").on("click", function () {
        updateTender(2);
      });

      $("#numberButton[data-value='10']").on("click", function () {
        updateTender(10);
      });

      // store Bill to local storage
      document
        .getElementById("saveButton")
        .addEventListener("click", function () {
          // Retrieve values from the respective elements
          const amount = document
            .getElementById("amount")
            .innerText.replace("$", "");
          const gstAmount = document
            .getElementById("gstAmount")
            .innerText.replace("$", "");
          const payableAmount = document
            .getElementById("payableAmount")
            .innerText.replace("$", "");
          const tender = document
            .getElementById("tender")
            .innerText.replace("$", "");
          const change = document
            .getElementById("change")
            .innerText.replace("$", "");

          // Create an object to hold the data
          const billingData = {
            amount: parseFloat(amount),
            gstAmount: parseFloat(gstAmount),
            payableAmount: parseFloat(payableAmount),
            tender: parseFloat(tender),
            change: parseFloat(change),
          };

          // Store the object in local storage as a JSON string
          localStorage.setItem("billingData", JSON.stringify(billingData));

          console.log("Stored Successfully!!!");
        });

      // for redirect to print page
      document
        .getElementById("saveButton")
        .addEventListener("click", function () {
          window.location.href = "printBill.html";
        });

      // Print Bill
      document
        .getElementById("printButton")
        .addEventListener("click", function () {
          printBill();
        });

      function printBill() {
        var printContents = document.getElementById("billContent").innerHTML;
        var originalContents = document.body.innerHTML;

        // Temporarily replace the entire body content with the bill content
        document.body.innerHTML = printContents;

        window.print();

        // Restore the original content after printing
        document.body.innerHTML = originalContents;
      }

      // For Sales record page
      $("#newBillButton").click(function () {
        const tableData = [];
        $("#addedItemsBody tr").each(function () {
          const itemName = $(this).find("td:eq(0)").text();
          const quantity = parseInt($(this).find("td:eq(1)").text());
          const unitPrice = parseFloat(
            $(this).find("td:eq(2)").text().replace("$", "")
          );
          const totalPrice = parseFloat(
            $(this).find("td:eq(3)").text().replace("$", "")
          );
          tableData.push({ itemName, quantity, unitPrice, totalPrice });
        });

        // Store the table data and total amount in localStorage
        localStorage.setItem("tableData", JSON.stringify(tableData));
        localStorage.setItem("totalAmount", totalCost.toFixed(2));

        // Navigate to the bill records page
        window.location.href = "SalesReport.html";
      });
    </script>
  </body>
</html>
