<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POS</title>
    <link rel="stylesheet" href="billing.css" />
    <!-- Bootstrap CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <header class="header"></header>
    <main>
      <div class="left-section">
        <div class="left-start-section">
          <div class="total-price">
            Total Price: $<span id="payableAmount">0.00</span>
          </div>
          <div class="table">
            <table id="addedItemsTable" class="">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Total Price</th>
                </tr>
              </thead>
              <tbody id="addedItemsBody"></tbody>
            </table>
          </div>
        </div>
        <div class="left-center-section h-25">
          <p></p>
        </div>
        <div class="left-end-section" style="position: sticky">
          <div class="left-end-top">
            <form action="" method="POST">
              <div>
                Item Name <br />
                <select class="form-select" id="itemName">
                  <option selected disabled>Select an Item</option>
                </select>
              </div>
              <div>
                Quantity <br />
                <input
                  type="number"
                  name="quantity"
                  id="quantity"
                  value="1"
                  min="1"
                  required
                />
              </div>
              <div>
                <br />
                <button name="add" id="addItem">Add</button>
              </div>
            </form>
          </div>
          <br />
          <div class="left-end-bottom">
            <div class="left-end-bottom-start">
              <div>
                <button name="lang">Language</button>
                <div>
                  <center>Table No</center>
                  <input type="number" name="table-no" id="table-no" />
                </div>
                <div>
                  <center>No of Cover</center>
                  <input type="number" name="cover-nos" id="cover-nos" />
                </div>
              </div>
            </div>
            <div class="left-end-bottom-center">
              <div class="number-grid">
                <button name="cal" class="numberButton" data-value="7">
                  7
                </button>
                <button name="cal" class="numberButton" data-value="8">
                  8
                </button>
                <button name="cal" class="numberButton" data-value="9">
                  9
                </button>
                <button name="cal" class="numberButton" data-value="4">
                  4
                </button>
                <button name="cal" class="numberButton" data-value="5">
                  5
                </button>
                <button name="cal" class="numberButton" data-value="6">
                  6
                </button>
                <button name="cal" class="numberButton" data-value="1">
                  1
                </button>
                <button name="cal" class="numberButton" data-value="2">
                  2
                </button>
                <button name="cal" class="numberButton" data-value="3">
                  3
                </button>
                <button name="cal" class="numberButton" data-value="0">
                  0
                </button>
                <button name="cal">.</button>
                <button name="cal">-</button>
              </div>
            </div>
            <div class="left-end-bottom-end">
              <div>
                <button name="ac" id="removeButton">AC</button>
              </div>
              <div>
                <button name="clear" id="clearButton">Clear</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="right-section">
        <div class="right-top-section">
          <div class="sidebar">
            <div class="sidebar-nav">
              <button class="up-btn">
                <img src="" alt="" class="btn-icon" />
              </button>
              <button class="sidebar-btns">Steamed Bun</button>
              <button class="sidebar-btns">Steamed Timsum</button>
              <button class="sidebar-btns">Beverage</button>
              <button class="sidebar-btns">Bake</button>
              <button class="sidebar-btns">Noodle/<br />Dumplinge</button>
              <button class="sidebar-btns">Porridge</button>
              <button class="down-btn">
                <img src="" alt="" class="btn-icon" />
              </button>
            </div>
          </div>
          <div class="inventory">
            <!-- Images loaded based on inventory items -->
          </div>
        </div>
        <div class="right-bottom-section">
          <div class="box1">
            <button class="box1-btn1">New Bill</button>
            <button class="box1-btn2">Price Amendment</button>
          </div>
          <div class="box2">
            <button class="box2-btn1">$2</button>
          </div>
          <div class="box3">
            <button class="box3-btn1">$10</button>
          </div>
          <div class="box4">
            <button class="box4-btn1">Open Cash Box</button>
            <button class="box4-btn2">Terminate Transaction</button>
          </div>
          <div class="box5">
            <button class="box5-btn1">Goods Return</button>
            <button class="box5-btn2">Print</button>
          </div>
          <div class="box6">
            <button class="box6-btn1" id="cancelItem">Cancel Item</button>
          </div>
          <div class="box7">
            <button class="box7-btn1">Add Item</button>
          </div>
          <div class="box8">
            <button class="box8-btn1">
              <a href="billing2.html" class="text-light text-decoration-none"
                ><i class="fa-solid fa-play" style="color: #000000"
                  ><span
                    class="text-light mx-1"
                    style="
                      font-family: 'Trebuchet MS', 'Lucida Sans Unicode',
                        'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
                    "
                    >Bill</span
                  ></i
                ></a
              >
            </button>
          </div>
          <div class="box9">
            <button class="box9-btn1">$5</button>
          </div>
          <div class="box10">
            <button class="box10-btn1">$50</button>
          </div>
          <div class="box11">
            <button class="box11-btn1">Gift Voucher</button>
          </div>
          <div class="box12">
            <button class="box12-btn1">Reserved Transaction</button>
            <button class="box12-btn2">Restore</button>
          </div>
          <div class="box13">
            <button class="box13-btn1">Delete All Transaction</button>
          </div>
          <div class="box14">
            <button class="box14-btn1">
              <a href="index.html" class="text-light text-decoration-none"
                >Main Menu</a
              >
            </button>
          </div>
        </div>
      </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

    <script>
      const inventory =
        JSON.parse(localStorage.getItem("inventory")) || sampleInventory;
      let totalCost = 0;

      function populateItemDropdown() {
        const itemSelect = $("#itemName");
        inventory.forEach((item) => {
          itemSelect.append(
            `<option value="${item.name.toLowerCase()}">${
              item.name
            } - $${parseFloat(item.price).toFixed(2)}</option>`
          );
          // Load images dynamically based on inventory
          $(".inventory").append(
            `<button class="image" data-name="${item.name.toLowerCase()}" data-price="${
              item.price
            }"><img src="${item.image}" alt="${
              item.name
            }" class="items" /></button>`
          );
        });
      }

      // Add item to billing table
      $("#addItem").on("click", function (e) {
        e.preventDefault();
        const itemName = $("#itemName").val();
        const quantity = parseInt($("#quantity").val()) || 1;
        const itemPrice = parseFloat(
          inventory.find((item) => item.name.toLowerCase() === itemName).price
        );
        const totalItemPrice = itemPrice * quantity;

        totalCost += totalItemPrice;
        $("#payableAmount").text(totalCost.toFixed(2));

        $("#addedItemsBody").append(`
                <tr>
                    <td>${itemName}</td>
                    <td>${quantity}</td>
                    <td>$${itemPrice.toFixed(2)}</td>
                    <td>$${totalItemPrice.toFixed(2)}</td>
                </tr>
            `);
        $("#quantity").val(1); // Reset quantity to 1
      });

      // Handle item image click to add to billing table
      $(document).on("click", ".image", function () {
        const itemName = $(this).data("name");
        const itemPrice = parseFloat($(this).data("price"));
        $("#itemName").val(itemName);
        $("#quantity").val(1); // Set default quantity to 1
        $("#addItem").trigger("click"); // Add item to table
      });

      // For click num button to load input field
      $(document).on("click", ".numberButton", function () {
        let currentQuantity = $("#quantity").val();
        // If the current quantity is 0, replace it with the new value; otherwise, append the new value
        if (currentQuantity === "0") {
          $("#quantity").val($(this).data("value"));
        } else {
          $("#quantity").val(currentQuantity + $(this).data("value"));
        }
      });

      // AC button functionality to remove last digit
      $("#removeButton").on("click", function (e) {
        e.preventDefault(); // Prevent default form submission
        let currentQuantity = $("#quantity").val();
        // Remove the last digit or reset to 0 if no digits are left
        if (currentQuantity.length > 1) {
          $("#quantity").val(currentQuantity.slice(0, -1));
        } else {
          $("#quantity").val("0");
        }
      });

      // Clear button functionality to remove entire number
      $("#clearButton").on("click", function (e) {
        e.preventDefault(); // Prevent default form submission
        $("#quantity").val("0"); // Set quantity to 0
      });

      // Cancel Item button functionality to remove the last row from the table
      $("#cancelItem").on("click", function (e) {
        e.preventDefault(); // Prevent default form submission
        const lastRow = $("#addedItemsBody tr").last(); // Get the last row in the table

        if (lastRow.length) {
          // Check if there is a last row
          const totalRowPrice = parseFloat(
            lastRow.find("td:last").text().replace("$", "")
          ); // Get the total price from the last row
          totalCost -= totalRowPrice; // Deduct the total price from totalCost
          $("#payableAmount").text(totalCost.toFixed(2)); // Update the displayed total price
          lastRow.remove(); // Remove the last row from the table
        }
      });

      // Bill button functionality to save total amount and navigate to the next page
      $(".box8-btn1 a").on("click", function (e) {
        e.preventDefault(); // Prevent default anchor behavior
        localStorage.setItem("totalAmount", totalCost.toFixed(2)); // Store total amount in localStorage
        window.location.href = "billing2.html"; // Navigate to the next page
      });

      // Load items into the dropdown and inventory on page load
      $(document).ready(function () {
        populateItemDropdown();
      });
    </script>
  </body>
</html>
