<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales Report</title>
    <link rel="stylesheet" href="billing.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Add jQuery library -->
</head>
<body>
    <div class="container mt-4">
        <div class="mb-3">
            <label for="filter" class="form-label">Filter Records:</label>
            <select id="filter" class="form-select">
                <option value="all">All Data</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="this_week">This Week</option>
                <option value="last_week">Last Week</option>
                <option value="this_month">This Month</option>
                <option value="last_month">Last Month</option>
            </select>
        </div>

        <table id="billingRecordTable" class="table">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total Price</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="billingRecordBody">
                <!-- Data will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        $(document).ready(function () {
            // Function to load table data
            function loadTableData(filter = "all") {
                const existingAnotherData = localStorage.getItem("anotherTableData");
                const anotherTableData = JSON.parse(existingAnotherData) || [];

                $("#billingRecordBody").empty(); // Clear previous data

                // Filter data based on the selected filter option
                const filteredData = filterData(anotherTableData, filter);

                if (filteredData.length > 0) {
                    filteredData.forEach(item => {
                        const row = `
                            <tr>
                                <td>${item.itemName}</td>
                                <td>${item.quantity}</td>
                                <td>$${item.unitPrice.toFixed(2)}</td>
                                <td>$${item.totalPrice.toFixed(2)}</td>
                                <td>${new Date(item.date).toLocaleString()}</td>
                            </tr>
                        `;
                        $("#billingRecordBody").append(row);
                    });
                } else {
                    $("#billingRecordBody").append("<tr><td colspan='5'>No data available</td></tr>");
                }
            }

            // Function to filter data based on the selected filter option
            function filterData(data, filter) {
                const today = new Date();
                let startDate, endDate;

                return data.filter(item => {
                    const itemDate = new Date(item.date);

                    switch (filter) {
                        case "today":
                            return itemDate.toDateString() === today.toDateString();
                        case "yesterday":
                            const yesterday = new Date(today);
                            yesterday.setDate(today.getDate() - 1);
                            return itemDate.toDateString() === yesterday.toDateString();
                        case "this_week":
                            startDate = new Date(today);
                            startDate.setDate(today.getDate() - today.getDay()); // Start of the week (Sunday)
                            endDate = new Date(today);
                            endDate.setDate(today.getDate() + (6 - today.getDay())); // End of the week (Saturday)
                            return itemDate >= startDate && itemDate <= endDate;
                        case "last_week":
                            startDate = new Date(today);
                            startDate.setDate(today.getDate() - today.getDay() - 7); // Start of last week
                            endDate = new Date(today);
                            endDate.setDate(today.getDate() - today.getDay() - 1); // End of last week
                            return itemDate >= startDate && itemDate <= endDate;
                        case "this_month":
                            return itemDate.getMonth() === today.getMonth() && itemDate.getFullYear() === today.getFullYear();
                        case "last_month":
                            const lastMonth = new Date(today);
                            lastMonth.setMonth(today.getMonth() - 1);
                            return itemDate.getMonth() === lastMonth.getMonth() && itemDate.getFullYear() === lastMonth.getFullYear();
                        case "all":
                        default:
                            return true; // Include all records
                    }
                });
            }

            // Function to add a new bill
            function addNewBill(itemName, quantity, unitPrice) {
                const totalPrice = quantity * unitPrice;
                const date = new Date().toISOString(); // Get current date in ISO format
                const newBill = { itemName, quantity, unitPrice, totalPrice, date };

                // Save to local storage
                const storedData = localStorage.getItem("tableData");
                const tableData = JSON.parse(storedData) || [];
                tableData.push(newBill);
                localStorage.setItem("tableData", JSON.stringify(tableData));

                // Save to anotherTableData
                const existingAnotherData = localStorage.getItem("anotherTableData");
                const anotherTableData = JSON.parse(existingAnotherData) || [];
                anotherTableData.push(newBill);
                localStorage.setItem("anotherTableData", JSON.stringify(anotherTableData));

                // Reload the table
                loadTableData();
            }

            // Call the function to load data on page load
            loadTableData();

            // Change event for the dropdown filter
            $("#filter").change(function () {
                const selectedFilter = $(this).val();
                loadTableData(selectedFilter);
            });

            // Example usage of addNewBill (uncomment to test adding new bills)
            // addNewBill('Sample Item 1', 2, 15.00); // Example item 1
            // addNewBill('Sample Item 2', 1, 25.50); // Example item 2
        });
    </script>
</body>
</html>
