<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales Report</title>
    <link rel="stylesheet" href="billing.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <header class="header"></header>
    <main class="container mt-4">
        <h2>Sales Report</h2>
        <div class="mb-3">
            <label for="filter" class="form-label">Filter by:</label>
            <select id="filter" class="form-select" onchange="displaySalesRecords(this.value)">
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="thisWeek">This Week</option>
                <option value="lastWeek">Last Week</option>
                <option value="lastMonth">Last Month</option>
                <option value="all">All</option>
            </select>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">S.No</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Purchased Quantity</th>
                    <th scope="col">Total Price</th>
                </tr>
            </thead>
            <tbody id="salesTableBody">
                <!-- Sales records will be populated here -->
            </tbody>
        </table>
    </main>

    <script>
        // Function to display sales records
        function displaySalesRecords(filter) {
            const salesRecords = JSON.parse(localStorage.getItem("salesRecords")) || [];
            console.log(salesRecords); // Log the sales records to see what's there
            const salesTableBody = document.getElementById("salesTableBody");
            salesTableBody.innerHTML = ""; // Clear existing content

            // Filter records based on selected filter
            const filteredRecords = salesRecords.filter(record => {
                const recordDate = new Date(record.date);
                const today = new Date();
                const yesterday = new Date();
                yesterday.setDate(today.getDate() - 1);
                const firstDayOfWeek = new Date();
                firstDayOfWeek.setDate(today.getDate() - today.getDay());
                const lastWeek = new Date();
                lastWeek.setDate(today.getDate() - 7);
                const lastMonth = new Date();
                lastMonth.setMonth(today.getMonth() - 1);

                switch (filter) {
                    case "today":
                        return recordDate.toDateString() === today.toDateString();
                    case "yesterday":
                        return recordDate.toDateString() === yesterday.toDateString();
                    case "thisWeek":
                        return recordDate >= firstDayOfWeek;
                    case "lastWeek":
                        return recordDate < firstDayOfWeek && recordDate >= lastWeek;
                    case "lastMonth":
                        return recordDate.getMonth() === lastMonth.getMonth() && recordDate.getFullYear() === lastMonth.getFullYear();
                    case "all":
                        return true;
                    default:
                        return true;
                }
            });

            console.log(filteredRecords); // Log the filtered records

            // Populate the table with filtered records
            filteredRecords.forEach((record, index) => {
                const row = `<tr>
                                <td>${index + 1}</td> <!-- Serial number -->
                                <td>${record.itemName}</td>
                                <td>${record.quantity}</td>
                                <td>$${record.totalPrice.toFixed(2)}</td>
                             </tr>`;
                salesTableBody.innerHTML += row;
            });
        }

        // Call the display function initially to load all records
        displaySalesRecords("all");
        // Uncomment the line below to save sample records on page load
        // saveSampleRecords();
        
        // Function to save sales record in localStorage
        function saveSalesRecord(itemName, quantity, totalPrice) {
            const salesRecord = {
                itemName: itemName,
                quantity: quantity,
                totalPrice: totalPrice,
                date: new Date().toISOString() // Save the current date and time
            };

            const existingRecords = JSON.parse(localStorage.getItem("salesRecords")) || [];
            existingRecords.push(salesRecord);
            localStorage.setItem("salesRecords", JSON.stringify(existingRecords));
        }

        saveSalesRecord()
    </script>
</body>
</html>
